<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta name="robots" content="index,follow">
    <title>src/js/sources/ibm/common/modules/masthead.js - IBM v18 (Northstar) common Javascript documentation</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" href="http://www.ibm.com/favicon.ico">
    <script>
        digitalData = {
            page: {
                pageInfo: {
                    effectiveDate: '2017-02-25',
                    expiryDate: '2020-02-25',
                    language: 'en-US',
                    publishDate: '2017-02-25',
                    publisher: 'IBM Corporation',
                    ibm: {
                        contentDelivery: 'yuidoc via grunt',
                        contentProducer: 'Michael Santelia',
                        country: 'US',
                        owner: 'Michael Santelia'
                    }
                }
            }
        };
    </script>

    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>

    <script>

		var lastUpdate = new Date(document.lastModified),
			updatedMonth = lastUpdate.getMonth(),
			updatedDate = lastUpdate.getDate(),
			updatedYear = lastUpdate.getFullYear(),
			today = new Date(),
			todayMonth = today.getMonth(),
			todayDate = today.getDate(),
			todayYear = today.getFullYear(),
			monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"],
			lastUpdatedText = "",
			daysAgo = Math.floor((today - lastUpdate) / (1000*60*60*24));

		updatedMonthName = monthNames[updatedMonth];

		switch (daysAgo) {

			case 1: 
				lastUpdatedText = "Updated yesterday";
				break;
				
			case 0: 
				lastUpdatedText = "Updated today";
				break;
				
			default: 
				lastUpdatedText = "Updated " + daysAgo + " days ago";
				break;
		}

		if (daysAgo > 4) {
			lastUpdatedText = "Updated: " + updatedMonthName + " " + updatedDate + ", " + updatedYear;
		}

    </script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-1-2">
            <div style="background: url(http://1.www.s81c.com/i/v17/t/ibm-logo.png) no-repeat scroll 0px 0px transparent; width: 105px; height: 45px; margin: 0.85em 0px;text-indent:-9999px;">IBM v18 (Northstar) common Javascript documentation</div>
        </div>
        <div class="yui3-u-1-2 version">
            <em>Javascript documentation for: IBM v18 (Northstar)<br />
            	<span style="font-size: 0.6em; position: absolute; right: 35px;"><script>document.writeln(lastUpdatedText)</script></span></em>
        </div>
    </div>
    
    <p><a href="../assets../../v18-js-source-documentation.zip" style="margin-left: 10px; padding-left: 15px; background: url(http://1.www.s81c.com/i/v17/icons/ibm_sprite_transactional_blue_ON.png) no-repeat 0 -202px;">Download a copy of this documentation (ZIP).</a></p>
    
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4" style="float: left;width:25%;">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/IBMCore.common.module.backtotop.html">IBMCore.common.module.backtotop</a></li>
                                <li><a href="../classes/IBMCore.common.module.canadanotice.html">IBMCore.common.module.canadanotice</a></li>
                                <li><a href="../classes/IBMCore.common.module.contactmodule.html">IBMCore.common.module.contactmodule</a></li>
                                <li><a href="../classes/IBMCore.common.module.footer.html">IBMCore.common.module.footer</a></li>
                                <li><a href="../classes/IBMCore.common.module.footermenu.html">IBMCore.common.module.footermenu</a></li>
                                <li><a href="../classes/IBMCore.common.module.leftnav.html">IBMCore.common.module.leftnav</a></li>
                                <li><a href="../classes/IBMCore.common.module.liveperson.html">IBMCore.common.module.liveperson</a></li>
                                <li><a href="../classes/IBMCore.common.module.localeselector.html">IBMCore.common.module.localeselector</a></li>
                                <li><a href="../classes/IBMCore.common.module.localpagenotification.html">IBMCore.common.module.localpagenotification</a></li>
                                <li><a href="../classes/IBMCore.common.module.masthead.html">IBMCore.common.module.masthead</a></li>
                                <li><a href="../classes/IBMCore.common.module.masthead.sticky.html">IBMCore.common.module.masthead.sticky</a></li>
                                <li><a href="../classes/IBMCore.common.module.mastheadbanner.html">IBMCore.common.module.mastheadbanner</a></li>
                                <li><a href="../classes/IBMCore.common.module.mastheadsearch.html">IBMCore.common.module.mastheadsearch</a></li>
                                <li><a href="../classes/IBMCore.common.module.merchandising.html">IBMCore.common.module.merchandising</a></li>
                                <li><a href="../classes/IBMCore.common.module.mobilemenu.html">IBMCore.common.module.mobilemenu</a></li>
                                <li><a href="../classes/IBMCore.common.module.sharethiscontent.html">IBMCore.common.module.sharethiscontent</a></li>
                                <li><a href="../classes/IBMCore.common.module.sharethispage.html">IBMCore.common.module.sharethispage</a></li>
                                <li><a href="../classes/IBMCore.common.module.sitenavmenu.html">IBMCore.common.module.sitenavmenu</a></li>
                                <li><a href="../classes/IBMCore.common.module.urx.html">IBMCore.common.module.urx</a></li>
                                <li><a href="../classes/IBMCore.common.translations.html">IBMCore.common.translations</a></li>
                                <li><a href="../classes/IBMCore.common.util.a11y.html">IBMCore.common.util.a11y</a></li>
                                <li><a href="../classes/IBMCore.common.util.addCssRule.html">IBMCore.common.util.addCssRule</a></li>
                                <li><a href="../classes/IBMCore.common.util.anchorlinkAdjustment.html">IBMCore.common.util.anchorlinkAdjustment</a></li>
                                <li><a href="../classes/IBMCore.common.util.bitly.html">IBMCore.common.util.bitly</a></li>
                                <li><a href="../classes/IBMCore.common.util.color.html">IBMCore.common.util.color</a></li>
                                <li><a href="../classes/IBMCore.common.util.config.html">IBMCore.common.util.config</a></li>
                                <li><a href="../classes/IBMCore.common.util.convertSecondsToHMS.html">IBMCore.common.util.convertSecondsToHMS</a></li>
                                <li><a href="../classes/IBMCore.common.util.cookie.html">IBMCore.common.util.cookie</a></li>
                                <li><a href="../classes/IBMCore.common.util.coreservices.html">IBMCore.common.util.coreservices</a></li>
                                <li><a href="../classes/IBMCore.common.util.data.html">IBMCore.common.util.data</a></li>
                                <li><a href="../classes/IBMCore.common.util.debug.html">IBMCore.common.util.debug</a></li>
                                <li><a href="../classes/IBMCore.common.util.eventCoordinator.html">IBMCore.common.util.eventCoordinator</a></li>
                                <li><a href="../classes/IBMCore.common.util.freezeScrollbars.html">IBMCore.common.util.freezeScrollbars</a></li>
                                <li><a href="../classes/IBMCore.common.util.gatekeeper.html">IBMCore.common.util.gatekeeper</a></li>
                                <li><a href="../classes/IBMCore.common.util.generateId.html">IBMCore.common.util.generateId</a></li>
                                <li><a href="../classes/IBMCore.common.util.getCurrentGridSize.html">IBMCore.common.util.getCurrentGridSize</a></li>
                                <li><a href="../classes/IBMCore.common.util.getDataAttributes.html">IBMCore.common.util.getDataAttributes</a></li>
                                <li><a href="../classes/IBMCore.common.util.getScrollbarWidth.html">IBMCore.common.util.getScrollbarWidth</a></li>
                                <li><a href="../classes/IBMCore.common.util.has12grid.html">IBMCore.common.util.has12grid</a></li>
                                <li><a href="../classes/IBMCore.common.util.hasScrollbars.html">IBMCore.common.util.hasScrollbars</a></li>
                                <li><a href="../classes/IBMCore.common.util.meta.html">IBMCore.common.util.meta</a></li>
                                <li><a href="../classes/IBMCore.common.util.perf.html">IBMCore.common.util.perf</a></li>
                                <li><a href="../classes/IBMCore.common.util.queue.html">IBMCore.common.util.queue</a></li>
                                <li><a href="../classes/IBMCore.common.util.scrolledintoview.html">IBMCore.common.util.scrolledintoview</a></li>
                                <li><a href="../classes/IBMCore.common.util.scrolltracker.html">IBMCore.common.util.scrolltracker</a></li>
                                <li><a href="../classes/IBMCore.common.util.setIpcCookie.html">IBMCore.common.util.setIpcCookie</a></li>
                                <li><a href="../classes/IBMCore.common.util.statshelper.html">IBMCore.common.util.statshelper</a></li>
                                <li><a href="../classes/IBMCore.common.util.storage.html">IBMCore.common.util.storage</a></li>
                                <li><a href="../classes/IBMCore.common.util.string.htmlspecialchars.html">IBMCore.common.util.string.htmlspecialchars</a></li>
                                <li><a href="../classes/IBMCore.common.util.url.html">IBMCore.common.util.url</a></li>
                                <li><a href="../classes/IBMCore.common.util.user.html">IBMCore.common.util.user</a></li>
                                <li><a href="../classes/IBMCore.common.widget.carousel.html">IBMCore.common.widget.carousel</a></li>
                                <li><a href="../classes/IBMCore.common.widget.ccfintercept.html">IBMCore.common.widget.ccfintercept</a></li>
                                <li><a href="../classes/IBMCore.common.widget.datatable.html">IBMCore.common.widget.datatable</a></li>
                                <li><a href="../classes/IBMCore.common.widget.datepicker.html">IBMCore.common.widget.datepicker</a></li>
                                <li><a href="../classes/IBMCore.common.widget.dyntabs.html">IBMCore.common.widget.dyntabs</a></li>
                                <li><a href="../classes/IBMCore.common.widget.fileinput.html">IBMCore.common.widget.fileinput</a></li>
                                <li><a href="../classes/IBMCore.common.widget.forms.html">IBMCore.common.widget.forms</a></li>
                                <li><a href="../classes/IBMCore.common.widget.formvalidator.html">IBMCore.common.widget.formvalidator</a></li>
                                <li><a href="../classes/IBMCore.common.widget.leavingibm.html">IBMCore.common.widget.leavingibm</a></li>
                                <li><a href="../classes/IBMCore.common.widget.manager.html">IBMCore.common.widget.manager</a></li>
                                <li><a href="../classes/IBMCore.common.widget.masonry.html">IBMCore.common.widget.masonry</a></li>
                                <li><a href="../classes/IBMCore.common.widget.overlay.html">IBMCore.common.widget.overlay</a></li>
                                <li><a href="../classes/IBMCore.common.widget.parallaxscroll.html">IBMCore.common.widget.parallaxscroll</a></li>
                                <li><a href="../classes/IBMCore.common.widget.rssdisplay.html">IBMCore.common.widget.rssdisplay</a></li>
                                <li><a href="../classes/IBMCore.common.widget.scrollable.html">IBMCore.common.widget.scrollable</a></li>
                                <li><a href="../classes/IBMCore.common.widget.selectlist.html">IBMCore.common.widget.selectlist</a></li>
                                <li><a href="../classes/IBMCore.common.widget.selectlistnav.html">IBMCore.common.widget.selectlistnav</a></li>
                                <li><a href="../classes/IBMCore.common.widget.setsameheight.html">IBMCore.common.widget.setsameheight</a></li>
                                <li><a href="../classes/IBMCore.common.widget.showhide.html">IBMCore.common.widget.showhide</a></li>
                                <li><a href="../classes/IBMCore.common.widget.stepindicator.html">IBMCore.common.widget.stepindicator</a></li>
                                <li><a href="../classes/IBMCore.common.widget.stickytabs.html">IBMCore.common.widget.stickytabs</a></li>
                                <li><a href="../classes/IBMCore.common.widget.syntaxhighlighter.html">IBMCore.common.widget.syntaxhighlighter</a></li>
                                <li><a href="../classes/IBMCore.common.widget.tablerowselector.html">IBMCore.common.widget.tablerowselector</a></li>
                                <li><a href="../classes/IBMCore.common.widget.tooltip.html">IBMCore.common.widget.tooltip</a></li>
                                <li><a href="../classes/IBMCore.common.widget.twisty.html">IBMCore.common.widget.twisty</a></li>
                                <li><a href="../classes/IBMCore.common.widget.videolooper.html">IBMCore.common.widget.videolooper</a></li>
                                <li><a href="../classes/IBMCore.common.widget.videoplayer.html">IBMCore.common.widget.videoplayer</a></li>
                                <li><a href="../classes/IBMCore.common.widget.videoplayer.kaltura.html">IBMCore.common.widget.videoplayer.kaltura</a></li>
                                <li><a href="../classes/IBMCore.common.widget.videoplayer.ustream.html">IBMCore.common.widget.videoplayer.ustream</a></li>
                                <li><a href="../classes/IBMCore.common.widget.videoplayer.youtube.html">IBMCore.common.widget.videoplayer.youtube</a></li>
                                <li><a href="../classes/IBMCore.namespace.html">IBMCore.namespace</a></li>
                                <li><a href="../classes/IBMCore.www.module.dynamiccontactmodule.html">IBMCore.www.module.dynamiccontactmodule</a></li>
                                <li><a href="../classes/IBMCore.www.module.truste.html">IBMCore.www.module.truste</a></li>
                                <li><a href="../classes/jQuery.browser.html">jQuery.browser</a></li>
                                <li><a href="../classes/jQuery.fn.dataTable.html">jQuery.fn.dataTable</a></li>
                                <li><a href="../classes/jQuery.fn.slick.html">jQuery.fn.slick</a></li>
                                <li><a href="../classes/jQuery.layout.html">jQuery.layout</a></li>
                                <li><a href="../classes/jQuery.os.html">jQuery.os</a></li>
                                <li><a href="../classes/jQuery:focusable.html">jQuery:focusable</a></li>
                                <li><a href="../classes/Masonry.html">Masonry</a></li>
                                <li><a href="../classes/Modernizr.html">Modernizr</a></li>
                                <li><a href="../classes/Mustache.html">Mustache</a></li>
                                <li><a href="../classes/NanoScroll.html">NanoScroll</a></li>
                                <li><a href="../classes/Other IBM - Canada notice loader.html">Other IBM - Canada notice loader</a></li>
                                <li><a href="../classes/Other IBM - common init.html">Other IBM - common init</a></li>
                                <li><a href="../classes/Other IBM - common v18 page tracker.html">Other IBM - common v18 page tracker</a></li>
                                <li><a href="../classes/Other IBM - errorchecking.html">Other IBM - errorchecking</a></li>
                                <li><a href="../classes/Other IBM - footer feedback link.html">Other IBM - footer feedback link</a></li>
                                <li><a href="../classes/Other IBM - grid change.html">Other IBM - grid change</a></li>
                                <li><a href="../classes/Other IBM - jstimer-end.html">Other IBM - jstimer-end</a></li>
                                <li><a href="../classes/Other IBM - jstimer-start.html">Other IBM - jstimer-start</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/IBMCore.html">IBMCore</a></li>
                                <li><a href="../modules/jQuery.browser.html">jQuery.browser</a></li>
                                <li><a href="../modules/jQuery.dataTable.html">jQuery.dataTable</a></li>
                                <li><a href="../modules/jQuery.slick.html">jQuery.slick</a></li>
                                <li><a href="../modules/Masonry.html">Masonry</a></li>
                                <li><a href="../modules/Modernizr.html">Modernizr</a></li>
                                <li><a href="../modules/Mustache.html">Mustache</a></li>
                                <li><a href="../modules/Nanoscroller.html">Nanoscroller</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4"style="float: left;width:75%;">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected" checked>
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private" checked>
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated" checked>
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/js/sources/ibm/common/modules/masthead.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /**
                        
                        	How the masthead works:
                        		#1. Popup - This is the absolute minimal, &quot;logo-only&quot; masthead only used on popup windows.
                        			This is the base, with all modules disabled.
                        		#2. Alternate - This is the &quot;application masthead&quot;. This is the same as default, but without the main link items
                        		#3. Full - This is the DEFAULT. This includes main link items and the megamenu. Inline links are hidden when browser is not wide enough.
                        
                        		Page owners can override and choose either &quot;alternate&quot; or &quot;popup&quot; masthead type via a page config.
                        
                        	If you are going to try and read this and understand how it all works, grab yourself a tall cup of coffee.
                        	The file is long, technically, but there are a LOT of comments in here.
                        	It&#x27;s not complicated, it&#x27;s just complex. There are functions for everything, and it&#x27;s really not that hard.
                        	The masthead is just comprised of a bunch of pieces of things that can be enabled/disabled and configured.
                        
                        **/
                        /**
                        
                        	Masthead.
                        	&lt;br /&gt;
                        	&lt;br /&gt;This is the main file for the masthead and everything associated with it.
                        	&lt;br /&gt;This waits for translations to be available and onload will create the main masthead links and associated functionality.
                        	&lt;br /&gt;
                        	&lt;br /&gt;Available options/settings:
                        		&quot;alternate&quot;: Same as the default, but WITHOUT the inline main masthead links.
                        		&quot;popup&quot;: For use ONLY on popup pages. Only the logo shows in the masthead.
                        
                        	@class IBMCore.common.module.masthead
                        
                        **/
                        (function($, IBM) {
                          /**
                        		Publishes this event after complete masthead is built.
                        
                        		@event ready
                        	**/
                          /**
                        		Publishes this event after the profile menu is built.
                        
                        		@event profileMenuReady
                        	**/
                        
                          var me = IBM.namespace(IBM, &#x27;common.module.masthead&#x27;),
                            myEvents = IBM.common.util.eventCoordinator(me, &#x27;masthead&#x27;, [
                              &#x27;ready&#x27;,
                              &#x27;profileMenuReady&#x27;,
                              &#x27;profileMenuUpdated&#x27;,
                            ]),
                            $elements = {
                              body: {},
                              masthead: {},
                            },
                            mastheadData = {
                              mainLinks: null,
                            },
                            mastheadLinklist = {
                              mainLinks: {
                                $el: null,
                                html: &#x27;&#x27;,
                              },
                              iconsonly: {
                                $el: null,
                                html: &#x27;&#x27;,
                              },
                              imagesloaded: {
                                // When a main item is opened first time, we set a flag and load the images.
                                // Images aren&#x27;t loaded until the main item is hovered and the menu is
                              },
                            },
                            mastheadType = &#x27;&#x27;,
                            mastheadTypeMapping = {
                              default: &#x27;full&#x27;,
                              alternate: &#x27;minimal&#x27;,
                              mobile: &#x27;mobile&#x27;,
                              popup: &#x27;popup&#x27;,
                            },
                            megamenu = {
                              $closeButtonLink: null,
                              $el: null,
                              $sectionShowing: null,
                              isopen: false,
                              $panelShowing: null,
                            },
                            makethese = {
                              megamenus: [],
                              dropdownmenus: [],
                            },
                            $profileMenu = null,
                            v18Data = {};
                        
                          me.isLoaded = false;
                        
                          /**
                        		Callback from subscription to meta data &#x27;ready&#x27; event publisher. Checks if masthead is enabled.
                        		&lt;br /&gt;If so, subscribe to translations and call init when translations are ready.
                        
                        		@method autoInit
                        	**/
                          me.autoInit = function() {
                            if (IBM.common.util.config.isEnabled(&#x27;masthead&#x27;)) {
                              me.init();
                            }
                          };
                        
                          /**
                        		Callback from subscription to translation &#x27;dataAndDomReady&#x27; event publisher inside autoInit.
                        		&lt;br /&gt;Runs several function to do three key things:
                        		&lt;br /&gt;1. Set the data sources.
                        		&lt;br /&gt;2. Create the links from the data sources.
                        		&lt;br /&gt;3. Configure the HTML per current page settings and echo it on the glass.
                        
                        		@method init
                        	**/
                          me.init = function() {
                            //  #### NOTE: ####
                            // In here, DOM is not ready yet.
                            // Do only the absolute required processing and HTML generation needed for content on the glass on page load.
                            // Defer everything else (hidden elements) via settimeout to put it to the back of the queue.
                            // For example: megamenu (if used), drop-down menus, mobile menu, and accessibility should all be deferred
                            //  because that can happen behind the scenes in the background.
                            //
                            // NOTE: ALL specific masthead elements are selector cached on injection. ID/Classes should NEVER be used after we
                            //  inject the HTML unless it&#x27;s for a specific condition. Always use the cached selectors (in var declaration at top).
                        
                            ////////////////////////////////////////////////////////////////////////
                            //  Varibles, config, data setups.
                            ////////////////////////////////////////////////////////////////////////
                        
                            // Pull in the applied setting for what masthead to use.
                            mastheadType = IBM.common.util.config.get(&#x27;masthead.type&#x27;);
                            mastheadType = mastheadTypeMapping[mastheadType];
                        
                            // Alias the translation file data.
                            v18Data = IBM.common.translations.data.v18main;
                        
                            // If the custom data object exists, use that for the data.
                            if (window.mhcustomtest) {
                              v18Data = window.mhcustomtest;
                            }
                        
                            // Alias the data set to use.
                            mastheadData.mainLinks = v18Data.mastheadNav;
                        
                            ////////////////////////////////////////////////////////////////////////
                            //  Create the actual link HTML
                            ////////////////////////////////////////////////////////////////////////
                            // CREATES THE ACTUAL MAIN MASTHEAD LINKS (ONLY).
                            // Create and store the &lt;li&gt; HTML for each masthead section. Any conditions or rules exist in the functions themselves.
                            mastheadLinklist.mainLinks.html = createMainMastheadLinks();
                            mastheadLinklist.iconsonly.html = createLinklistIconsonly();
                        
                            // CREATE THE BURGER MENU LINKS USING THE MASTHEAD MAIN LINK DATA.
                            // The burger menu uses this variable and pops it into a section in the burger menu.
                            // This is questionable whether this should go here or in burger menu JS file.
                            mastheadLinklist.mainLinks.burgerMenuHtml = createMainMastheadLinksBurgermenu(
                              mastheadData.mainLinks.links
                            );
                        
                            // Now that we&#x27;ve built the HTML, we&#x27;re ready to inject HTML and do setup and bindings.
                            // Get the main visible links on the glass ASAP, and create any &quot;hidden&quot; menus later/defered because they require
                            // user interaction to be seen which will not happen immediately, so they don&#x27;t need to be created *right now*.
                            $(function() {
                              /**
                        
                        				First we ONLY inject the links we need on the glass and any swizzling to get them out ASAP.
                        				Then we defer all &quot;setup&quot; functionality.
                        				Each of the createMasthead_____ functions adds a class that makes styling easy, based on the type of masthead.
                        
                        				Cases from minimal to maximum. What is always there, what isn&#x27;t:
                        
                        				If popup:
                        					- Disable and hide all
                        					- Stop.
                        
                        				If alternate:
                        					- Search
                        					- Iconsonly
                        
                        				If full: (Same as minimal but with visible catnav &amp; mega &amp; dropdown menus):
                        					- Main nav items
                        					- Search
                        					- Iconsonly
                        					- Megamenu
                        
                        			**/
                        
                              // Do some resets for the &quot;change page locale&quot; utility and wipe out the links.
                              // eslint-disable-next-line no-undef
                              IBMPerformance.mark(&#x27;V18-masthead-begin&#x27;);
                              $(
                                &#x27;#ibm-megamenu-sections, .ibm-masthead-categories, .ibm-masthead-iconsonly&#x27;
                              ).remove();
                        
                              // Cache selectors.
                              $elements.body = $(document.body);
                              $elements.masthead = $(document.getElementById(&#x27;ibm-masthead&#x27;));
                        
                              // Set popup masthead to not have anything extra created.
                              if (mastheadType === &#x27;popup&#x27;) {
                                createMastheadPopup();
                        
                                IBM.common.util.config.set({
                                  masthead: {
                                    megamenu: { enabled: false },
                                    mobilemenu: { enabled: false },
                                    profile: { enabled: false },
                                    search: { enabled: false },
                                    sticky: { enabled: false },
                                  },
                                });
                              } else if (mastheadType === &#x27;minimal&#x27;) {
                                createMastheadMinimal();
                                // Even though no main links, set hiding width for marketplace button hiding.
                                setMastheadWidthUsed();
                                setupSearchfieldResponsiveness();
                              } else if (mastheadType === &#x27;full&#x27;) {
                                createMastheadFull();
                                // Set the minimum viewport width we need in order to show all the links and injects dynamic media query style.
                                // Safari had weird render issue introduced in 10.1.2, have to slightly delay the calculation for it.
                                if (!$.browser.safari) {
                                  setMastheadWidthUsed();
                                } else {
                                  setTimeout(function() {
                                    setMastheadWidthUsed();
                                  }, 200);
                                }
                        
                                setupSearchfieldResponsiveness();
                        
                                // Setup each main masthead link item&#x27;s menu.
                                // Then bind each one to open it&#x27;s corresponding menu.
                                // (Each link is tagged with a data-linkid so onclick that&#x27;s the section/thing to show)
                                setTimeout(function() {
                                  if (IBM.common.util.config.isEnabled(&#x27;masthead.megamenu&#x27;)) {
                                    createMegamenus();
                                    createDropdownMenus();
                                    setupMegamenuBindings();
                                    setupMastheadMainlinksAccessibility();
                                  }
                                }, 50);
                              } else {
                                return;
                              }
                        
                              // Hide the sitemap link because we successfully created the masthead.
                              $(document.getElementById(&#x27;ibm-menu-links&#x27;)).addClass(&#x27;ibm-hide&#x27;);
                        
                              // NOTE: ALL specific masthead elements are selector cached on injection.
                              // ID/Classes should NEVER be used at this point unless it&#x27;s for a specific condition.
                              // Always use the cached selectors (in var declaration at top).
                        
                              ////////////////////////////////////////////////////////
                              // START COMMON DEFERRED ITEMS
                              ////////////////////////////////////////////////////////
                        
                              setTimeout(function() {
                                setupBurgerMenuIcon();
                        
                                $(document.getElementById(&#x27;ibm-home&#x27;)).find(&#x27;a&#x27;)[0].href += &#x27;?lnk=m&#x27;;
                        
                                // Create profile drop-down menu ONLY if it&#x27;s enabled.
                                // Creates &quot;anonymous&quot; menu by default, and if greeting service is enabled, makes call and waits for
                                //  return data to decide if it needs to change the menu links.
                                // Functions have logic in them for cases where country has no links or container (drop-down menu) doesn&#x27;t exist.
                                if (IBM.common.util.config.isEnabled(&#x27;masthead.profile&#x27;)) {
                                  addProfileMenuToMasthead();
                                  setupMastheadProfileMenu();
                                  setupMastheadProfileMenuAccessibility();
                                }
                              }, 50);
                        
                              // Tell subscribers the MAIN MASTHEAD LINKS are ready and on the glass (as appropriate).
                              // eslint-disable-next-line no-undef
                              IBMPerformance.mark(&#x27;V18-masthead-end&#x27;);
                              // eslint-disable-next-line no-undef
                              IBMPerformance.measure(
                                &#x27;V18-masthead-load&#x27;,
                                &#x27;V18-masthead-begin&#x27;,
                                &#x27;V18-masthead-end&#x27;
                              );
                        
                              me.isLoaded = true;
                              myEvents.publish(&#x27;ready&#x27;);
                            });
                          };
                        
                          /**
                        		Simply inserts the masthead main category links into the masthead.
                        		&lt;br /&gt;Eventually we will start making pages code these in the HTML when the changes settle down, for SEO purposes.
                        
                        		@method addMainlinksToMasthead
                        		@private
                        	**/
                          function addMainlinksToMasthead() {
                            // Inject the new categories nav links.
                            mastheadLinklist.mainLinks.$el = $(
                              mastheadLinklist.mainLinks.html
                            ).insertBefore(&#x27;#ibm-menu-links&#x27;);
                          }
                        
                          /**
                        		Inserts the masthead main ICON links into the masthead (inside a right-float container),
                        		 and moves the search div into the container also.
                        		&lt;br /&gt;Also caches the signin icon selector for updating with user state.
                        
                        		@method addIconsToMasthead
                        		@private
                        	**/
                          function addIconsToMasthead() {
                            // Put the icons in the right side container after the search field.
                            mastheadLinklist.iconsonly.$el.append(mastheadLinklist.iconsonly.html);
                            $profileMenu = mastheadLinklist.iconsonly.$el.find(
                              &#x27;.ibm-masthead-item-signin&#x27;
                            );
                          }
                        
                          /**
                        		Converts the search input to a button. It should be coded as a button, but legacy HTML has input.
                        
                        		@method convertSearchSubmitToButton
                        		@private
                        	**/
                          function convertSearchSubmitToButton() {
                            var attrs = &#x27;&#x27;,
                              $searchButton = $(document.getElementById(&#x27;ibm-search&#x27;))
                                .removeClass(&#x27;ibm-btn-search&#x27;)
                                .addClass(&#x27;ibm-search-link&#x27;);
                        
                            $.each($searchButton[0].attributes, function() {
                              attrs += &#x27; &#x27; + this.name + &#x27;=&quot;&#x27; + this.value + &#x27;&quot;&#x27;;
                            });
                        
                            $searchButton.replaceWith(
                              &#x27;&lt;button role=&quot;button&quot;&#x27; +
                                attrs +
                                &#x27;&gt;&lt;span class=&quot;ibm-access&quot;&gt;&#x27; +
                                $searchButton[0].value +
                                &#x27;&lt;/span&gt;&lt;/button&gt;&#x27;
                            );
                          }
                        
                          /**
                        		Take the passed array of link data, and create LIs using them.
                        
                        		@method createMenuListItems
                        		@private
                        		@param linkArr {Array} Arry of links to put into the list, prescribed format using id, title, url.
                        		@return {String} HTML of &amp;lt;li&gt;s for the list (UL).
                        	**/
                          function createMenuListItems(linkArr) {
                            var lis = &#x27;&#x27;;
                        
                            $.each(linkArr, function() {
                              var linkType =
                                  this.id &amp;&amp; this.id !== &#x27;&#x27; ? &#x27; data-linktype=&quot;&#x27; + this.id + &#x27;&quot;&#x27; : &#x27;&#x27;,
                                newWindow = this.newWindow !== true ? &#x27;&#x27; : &#x27; target=&quot;_blank&quot;&#x27;;
                              if (this.title) {
                                lis +=
                                  &#x27;&lt;li role=&quot;presentation&quot;&#x27; +
                                  linkType +
                                  &#x27;&gt;&lt;a role=&quot;menuitem&quot; href=&quot;&#x27; +
                                  this.url.replace(
                                    &#x27;{{window.location}}&#x27;,
                                    encodeURIComponent(window.location.href)
                                  ) +
                                  &#x27;&quot;&#x27; +
                                  newWindow +
                                  &#x27;&gt;&#x27; +
                                  this.title +
                                  &#x27;&lt;/a&gt;&lt;/li&gt;&#x27;;
                              }
                            });
                        
                            return lis;
                          }
                        
                          /**
                        		Add the new right-align container and put the search container into it.
                        
                        		@method setupRightsideContainer
                        		@private
                        	**/
                          function setupRightsideContainer() {
                            if (!mastheadLinklist.iconsonly.$el) {
                              mastheadLinklist.iconsonly.$el = $(
                                &#x27;&lt;div class=&quot;ibm-masthead-rightside&quot;&gt;&lt;/div&gt;&#x27;
                              )
                                .prepend($(document.getElementById(&#x27;ibm-search-module&#x27;)))
                                .insertAfter(document.getElementById(&#x27;ibm-menu-links&#x27;));
                            }
                          }
                        
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          //
                          // Profile icon and menu setup
                          //
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        
                          /**
                        		Creates &quot;anonymous&quot; profile menu and injects it.
                        		&lt;br /&gt;We have to wait for the service call to return to know if they are signed in, at which point we swap it.
                        
                        		@method addProfileMenuToMasthead
                        		@private
                        	**/
                          // NOTE: This happens in a defer to let other onscreen stuff run ahead.
                          function addProfileMenuToMasthead() {
                            var profileMenuLinks = createProfileMenuAnony();
                        
                            // Stop if there&#x27;s no sign-in links b/c it means there&#x27;s nothing to put in a menu.
                            if (
                              profileMenuLinks === &#x27;&#x27; &amp;&amp;
                              !IBM.common.util.config.isEnabled(&#x27;masthead.profileAlways&#x27;)
                            ) {
                              return;
                            }
                        
                            // Put the links inside a UL and inject into DOM.
                            $profileMenu.append(
                              &#x27;&lt;ul id=&quot;ibm-signin-minimenu-container&quot; role=&quot;menu&quot; aria-label=&quot;Profile&quot; class=&quot;ibm-dropdown-menu&quot;&gt;&#x27; +
                                profileMenuLinks +
                                &#x27;&lt;/ul&gt;&#x27;
                            );
                        
                            // Self subscribe for weird pub/sub bug.
                            me.subscribe(&#x27;profileMenuReady&#x27;, &#x27;self&#x27;, function() {});
                        
                            // If the greeting config is DISABLED, stop and leave the default &quot;anonymous&quot; menu there.
                            // User util does NOT call user profiles services if greeting disabled.
                            // Publish menu ready event so DW and PW can modify.
                            if (!IBM.common.util.config.isEnabled(&#x27;greeting&#x27;)) {
                              myEvents.publish(&#x27;profileMenuReady&#x27;);
                              return;
                            }
                        
                            // Getting here means greeting was enabled, so &quot;user state&quot; service was called.
                            // After getting the user data from IBMid, if they are signed in, &quot;updateProfileMenu&quot; changes the menu link
                            //   then fires an event.
                            // Subscribe to that event so that we can publish the master &quot;menu is totally done/ready&quot; event.
                            // If user wasn&#x27;t signed in, then &quot;menu is ready&quot; is called (code below this).
                            me.subscribe(&#x27;profileMenuUpdated&#x27;, &#x27;self&#x27;, function() {
                              myEvents.publish(&#x27;profileMenuReady&#x27;);
                            });
                        
                            // Wait until all IBM profile data from WSRs is ready and then modify the default anony profile container:
                            // Update icon with image from profile service.
                            // Change the menu to the &quot;signed in&quot; one.
                            // Show the new notification count(inside the menu update becuase we have to wait for it).
                            IBM.common.util.user
                              .subscribe(&#x27;userIBMDataReady&#x27;, &#x27;masthead&#x27;, function() {
                                if (IBM.common.util.user.getInfo().signedin) {
                                  IBM.common.util.debug.add(
                                    &#x27;log&#x27;,
                                    &#x27;User is signed in - Waited for IBMid WSR&#x27;
                                  );
                                  updateProfileIcon();
                                  updateProfileMenu();
                                } else {
                                  // User isn&#x27;t signed in, so there&#x27;s nothing to do, thus the menu is already ready. Fire away.
                                  myEvents.publish(&#x27;profileMenuReady&#x27;);
                                }
                              })
                              .runAsap(function() {
                                if (IBM.common.util.user.getInfo().signedin) {
                                  IBM.common.util.debug.add(
                                    &#x27;log&#x27;,
                                    &#x27;User is signed in - IBMid WSR already done&#x27;
                                  );
                                  updateProfileIcon();
                                  updateProfileMenu();
                                } else {
                                  // User isn&#x27;t signed in, so there&#x27;s nothing to do, thus the menu is already ready. Fire away.
                                  myEvents.publish(&#x27;profileMenuReady&#x27;);
                                }
                              });
                          }
                        
                          /**
                        		Creates the profile item drop down menu, default is as anonymous user using &quot;signed out&quot; links from xlation file.
                        		&lt;br /&gt;When service comes back with user-state determination, we change this *if user is signed in*.
                        
                        		@method createProfileMenuAnony
                        		@private
                        		@return {String} HTML of &amp;lt;li&gt;s for the list (UL).
                        	**/
                          function createProfileMenuAnony() {
                            return createMenuListItems(v18Data.profileMenu.signedout);
                          }
                        
                          /**
                        		This is called after we have determined that the user *is signed in*.
                        		&lt;br /&gt;It ONLY creates new LIs to inject into the existing drop down menu.
                        
                        		@method createProfileMenuSignedin
                        		@private
                        		@return {String} HTML of &amp;lt;li&gt;s for the list (UL).
                        	**/
                          function createProfileMenuSignedin() {
                            return createMenuListItems(v18Data.profileMenu.signedin);
                          }
                        
                          /**
                        		Public API to control the profile menu.
                        
                        		@method editProfileMenu
                        		@param data {Object} The data object to use to edit the profile menu with.
                        		@param data.action {String} What you want to do with the profile menu.
                        	**/
                          me.editProfileMenu = editProfileMenu;
                          function editProfileMenu(data) {
                            if (data.action === &#x27;replace&#x27;) {
                              $(document.getElementById(&#x27;ibm-signin-minimenu-container&#x27;)).html(
                                createMenuListItems(data.links)
                              );
                            } else if (data.action === &#x27;prepend&#x27;) {
                              $(document.getElementById(&#x27;ibm-signin-minimenu-container&#x27;)).prepend(
                                createMenuListItems(data.links)
                              );
                            } else if (data.action === &#x27;append&#x27;) {
                              $(document.getElementById(&#x27;ibm-signin-minimenu-container&#x27;)).append(
                                createMenuListItems(data.links)
                              );
                            } else if (data.action === &#x27;replaceLinkUrl&#x27;) {
                              $(document.getElementById(&#x27;ibm-signin-minimenu-container&#x27;))
                                .find(&quot;li[data-linktype=&#x27;&quot; + data.linktype + &quot;&#x27;] a&quot;)
                                .attr(&#x27;href&#x27;, data.linkurl);
                            }
                        
                            // Temp usage tracking.
                            // REMOVED: June 14, 2018
                            // IBM.common.util.statshelper.fireEvent({
                            // 	ibmEV : &quot;editprofilemenu&quot;,
                            // 	ibmEvAction : data.action || &quot;n/a&quot;
                            // });
                          }
                        
                          /**
                        		Sets up click anywhere to close for profile menu.
                        
                        		@method profileClickToClose
                        		@private
                        	**/
                          function profileClickToClose() {
                            $elements.body.on(&#x27;click&#x27;, function() {
                              me.hideProfileMenu();
                            });
                          }
                        
                          /**
                        		Resets the profile menu button to default state so it can be properly changed/set to another.
                        
                        		@method resetProfileButton
                        		@private
                        	**/
                          function resetProfileButton() {
                            mastheadLinklist.iconsonly.$el.removeClass(&#x27;signedin hasinitials&#x27;);
                            $profileMenu
                              .children(&#x27;button&#x27;)
                              .removeAttr(&#x27;style aria-label&#x27;)
                              .html(&#x27;&#x27;);
                          }
                        
                          /**
                        		Setup the bindings for the profile menu, called with defer becuase it&#x27;s not critical onload for display.
                        
                        		@method setupMastheadProfileMenu
                        		@private
                        	**/
                          function setupMastheadProfileMenu() {
                            var profileClickToCloseSetup = false;
                        
                            // If there&#x27;s no profile menu, there&#x27;s nothing to do here.
                            if (!$profileMenu[0]) {
                              return;
                            }
                        
                            // ONCLICK: Opening/Closing the drop-down menu.
                            $profileMenu.children(&#x27;button&#x27;).click(function(evt) {
                              evt.preventDefault();
                        
                              if ($profileMenu.hasClass(&#x27;ibm-active&#x27;)) {
                                me.hideProfileMenu();
                              } else {
                                // On click/(keypress) show the menu and focus on the first item in it.
                                me.showProfileMenu();
                                $profileMenu.find(&#x27;li:eq(0) a&#x27;).focus();
                        
                                // Since they clicked to open it, setup the &quot;click anywhere&quot; to close it.
                                if (!profileClickToCloseSetup) {
                                  profileClickToClose();
                                  profileClickToCloseSetup = true;
                                }
                              }
                            });
                        
                            // HOVER: OPENING the drop-down menu.
                            $profileMenu
                              .hoverIntent(
                                function() {
                                  me.showProfileMenu();
                                },
                                function() {
                                  // do nothing on mouse out. Covered by larger scoped element mouseout binding below.
                                }
                              )
                              .on(&#x27;click&#x27;, function(evt) {
                                // Stop propogation so our body &quot;closer&quot; binding doesn&#x27;t fire if they click on the menu
                                evt.stopPropagation();
                              });
                        
                            // HOVER: CLOSING the drop-down menu.
                            // If they mouse out of the entire menu section, wait 300ms and make sure they are leaving then close the menu.
                            $profileMenu.hoverIntent({
                              over: function() {},
                              out: function() {
                                me.hideProfileMenu();
                              },
                              timeout: 300,
                            });
                          }
                        
                          /**
                        		Public API to set/show a # of notifications in the profile menu.
                        		&lt;br&gt;If number is &gt; 0: show the count in the masthead profile thumb and in the special tagged menu item,
                        		&lt;br&gt;Else, remove the div (in cases of dynamic sign in/out without reload we don&#x27;t want empty or incorrect box #).
                        
                        		@method showNotificationCount
                        		@param num {Integer} The number to show in the profile menu.
                        	**/
                          me.showNotificationCount = showNotificationCount;
                          function showNotificationCount(num) {
                            var $iconNcContainer = $(
                                document.getElementsByClassName(&#x27;ibm-notification-count&#x27;)[0]
                              ),
                              $linkWithNc = $(
                                document.getElementsByClassName(&#x27;ibm-masthead-item-signin&#x27;)[0]
                              ).find(&quot;li[data-linktype=&#x27;notifications&#x27;] a&quot;);
                        
                            // For the link, that gets overritten each locale/masthead change and is a tag on a link.
                            // Show notification in icon.
                            // If the placeholder isn&#x27;t there, add it.
                            // Else remove it.
                            if (num &gt; 0) {
                              if (!$iconNcContainer[0]) {
                                $iconNcContainer = $(
                                  &#x27;&lt;div class=&quot;ibm-notification-count&quot;&gt;&lt;/div&gt;&#x27;
                                ).appendTo(&#x27;.ibm-masthead-item-signin&#x27;);
                              }
                        
                              $iconNcContainer.html(num);
                        
                              // For the link in the menu.
                              // If the link exists, check if the span is there already or not and add, then inject #.
                              if ($linkWithNc[0]) {
                                if (!$linkWithNc.children(&#x27;span&#x27;)[0]) {
                                  $linkWithNc.append(&#x27;&lt;span&gt;&lt;/span&gt;&#x27;);
                                }
                                $linkWithNc.children(&#x27;span&#x27;).html(&#x27; (&#x27; + num + &#x27;)&#x27;);
                              }
                            } else {
                              $iconNcContainer.remove();
                            }
                          }
                        
                          /**
                        		Resets the profile menu button and notification count and sets the a11y test to whatever you pass it.
                        
                        		@method showProfileLinkAnonymous
                        		@param dataObj {Object} Data to use to show the user profile button as &quot;anonymous user&quot;.
                        		@param dataObj.linkContents {String} The text/content to put inside of the button.
                        		@param dataObj.linkAlt {String} The text to use for the aria-label on the button.
                        	**/
                          me.showProfileLinkAnonymous = showProfileLinkAnonymous;
                          function showProfileLinkAnonymous(dataObj) {
                            resetProfileButton();
                            showNotificationCount(0);
                            $profileMenu
                              .children(&#x27;button&#x27;)
                              .html(dataObj.linkContents)
                              .attr(&#x27;aria-label&#x27;, dataObj.linkAlt);
                          }
                        
                          /**
                        		Public API that will display the button content and not hide them for accessibility.
                        		&lt;br&gt;Primarily used when you are showing text for the button instead of an image.
                        
                        		@method showProfileLinkContents
                        	**/
                          me.showProfileLinkContents = showProfileLinkContents;
                          function showProfileLinkContents() {
                            mastheadLinklist.iconsonly.$el.addClass(&#x27;hasinitials&#x27;);
                          }
                        
                          /**
                        		Public API to change/show the profile button as a signed-in user, uses the passed data object for the info.
                        
                        		@method showProfileLinkSignedin
                        		@param dataObj {Object} The data to use to show the user as signed-in.
                        		@param dataObj.linkContents {String} The text we&#x27;d show on the screen.
                        		@param dataObj.linkAlt {String} The aria-label for blind user who can&#x27;t see the visual meaning &quot;you&#x27;re signed in&quot;
                        		@param dataObj.backgroundImage {String} The background image URL to use for the button.
                        		@param dataObj.type {String} What type of &quot;signed-in&quot; visual to display; default, text, or image.
                        
                        	**/
                          me.showProfileLinkSignedin = showProfileLinkSignedin;
                          function showProfileLinkSignedin(dataObj) {
                            /**
                        			dataObj = {
                        				linkContents: &quot;&quot;, // The text we&#x27;d show on the screen.
                        				linkAlt: &quot;&quot;,  // The aria-label for blind user who can&#x27;t see the visual meaning &quot;you&#x27;re signed in&quot;
                        				backgroundImage: &quot;&quot;  // The image to use for the button.
                        				type: &quot;default|text|image&quot;  // What type of &quot;signed-in&quot; visual to display.
                        			};
                        		**/
                            resetProfileButton();
                        
                            mastheadLinklist.iconsonly.$el.addClass(&#x27;signedin&#x27;);
                            $profileMenu
                              .children(&#x27;button&#x27;)
                              .html(dataObj.linkContents)
                              .attr(&#x27;aria-label&#x27;, dataObj.linkAlt);
                        
                            // If there was a background image URL passed, set the button to use it.
                            // This overrides the default profile icon background.
                            if (
                              dataObj.type === &#x27;image&#x27; &amp;&amp;
                              dataObj.backgroundImage &amp;&amp;
                              dataObj.backgroundImage !== &#x27;&#x27;
                            ) {
                              mastheadLinklist.iconsonly.$el.addClass(&#x27;hasinitials&#x27;);
                        
                              $profileMenu
                                .children(&#x27;button&#x27;)
                                .html(&#x27;&#x27;)
                                .css({
                                  &#x27;background-image&#x27;: &#x27;url(&#x27; + dataObj.backgroundImage + &#x27;)&#x27;,
                                  &#x27;background-size&#x27;: &#x27;cover&#x27;,
                                });
                            }
                        
                            if (dataObj.type === &#x27;text&#x27; &amp;&amp; dataObj.linkContents !== &#x27;&#x27;) {
                              mastheadLinklist.iconsonly.$el.addClass(&#x27;hasinitials&#x27;);
                            }
                          }
                        
                          /**
                        		This swaps the &quot;anonymous&quot; profile ICON for the one returned from the IBM photo service.
                        		&lt;br /&gt;Default signed-in is reversed icon, if photo service returns personalized image url, we use that.
                        
                        		@method updateProfileIcon
                        		@private
                        	**/
                          function updateProfileIcon() {
                            var signedinData = {
                              linkContents: &#x27;&#x27;,
                              linkAlt: v18Data.misc.welcomeback,
                              backgroundImage: IBM.common.util.user.getInfo().imageUrl,
                              type: &#x27;default&#x27;,
                            };
                        
                            if (
                              !IBM.common.util.user.getInfo().imageUrl ||
                              IBM.common.util.user.getInfo().imageUrl === &#x27;&#x27;
                            ) {
                              signedinData.backgroundImage = &#x27;&#x27;;
                            }
                        
                            // Show the profile link as &quot;signed in&quot;.
                            showProfileLinkSignedin(signedinData);
                          }
                        
                          /**
                        		This swaps the &quot;anonymous&quot; profile menu with links for a &quot;signed in user&quot;
                        
                        		@method updateProfileMenu
                        		@private
                        	**/
                          function updateProfileMenu() {
                            var signedinListitems = createProfileMenuSignedin();
                        
                            // Change the menu to the &quot;user is signed in&quot; one ONLY if there are links from the translation data file.
                            // Otherwise we keep it as &quot;signedout&quot; links.
                            if (signedinListitems !== &#x27;&#x27;) {
                              // Make sure profile menu UL exists before trying to update it.
                              // Safety net in wacky cases where page blocks rendering and causes WSRs
                              //  to complete before the profile menu is created.
                              if (!($profileMenu &amp;&amp; $profileMenu.children(&#x27;ul&#x27;)[0])) {
                                IBM.common.util.debug.add(
                                  &#x27;log&#x27;,
                                  &#x27;Waiting for profile menu to be ready&#x27;
                                );
                              }
                              IBM.common.util.queue.push(
                                function() {
                                  return $profileMenu &amp;&amp; $profileMenu.children(&#x27;ul&#x27;)[0];
                                },
                                function() {
                                  IBM.common.util.debug.add(
                                    &#x27;log&#x27;,
                                    &quot;Profile menu now exists, changing to &#x27;signed in&#x27; menu&quot;
                                  );
                                  $profileMenu.children(&#x27;ul&#x27;).html(signedinListitems);
                                  showNotificationCount(
                                    IBM.common.util.user.getInfo().newNotificationCount
                                  );
                                  myEvents.publish(&#x27;profileMenuUpdated&#x27;);
                                }
                              );
                            }
                          }
                        
                          /**
                        		Public API to show the profile menu.
                        
                        		@method showProfileMenu
                        	**/
                          me.showProfileMenu = function() {
                            $profileMenu.addClass(&#x27;ibm-active&#x27;);
                          };
                        
                          /**
                        		Public API to show the hide menu.
                        
                        		@method hideProfileMenu
                        	**/
                          me.hideProfileMenu = function() {
                            $profileMenu.removeClass(&#x27;ibm-active&#x27;);
                          };
                        
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          //
                          // Masthead types setups.
                          //
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        
                          /**
                        		Adds a class to the masthead and concats all the pieces that create the &quot;full&quot; (default) masthead.
                        
                        		@method createMastheadFull
                        		@private
                        	**/
                          function createMastheadFull() {
                            $elements.masthead.addClass(&#x27;ibm-mhtype-full&#x27;);
                        
                            addMainlinksToMasthead();
                        
                            setupRightsideContainer();
                        
                            addIconsToMasthead();
                        
                            // If search is enabled, change the input to a button and add label for better a11y.
                            if (IBM.common.util.config.isEnabled(&#x27;masthead.search&#x27;)) {
                              convertSearchSubmitToButton();
                              document
                                .getElementById(&#x27;ibm-search-form&#x27;)
                                .setAttribute(&#x27;aria-labelledby&#x27;, &#x27;ibm-masthead&#x27;);
                            }
                          }
                        
                          /**
                        		Adds a class to the masthead and concats all the pieces that create the &quot;minimal&quot; (alternate) masthead.
                        		&lt;br /&gt;The nice name/config name is &quot;alternate&quot;. Technically it&#x27;s a &quot;minimal&quot; masthead.
                        
                        		@method createMastheadMinimal
                        		@private
                        	**/
                          function createMastheadMinimal() {
                            $elements.masthead.addClass(&#x27;ibm-mhtype-minimal&#x27;);
                        
                            //addMainlinksToMasthead();
                        
                            setupRightsideContainer();
                        
                            addIconsToMasthead();
                        
                            // If search is enabled, change the input to a button and add label for better a11y.
                            if (IBM.common.util.config.isEnabled(&#x27;masthead.search&#x27;)) {
                              convertSearchSubmitToButton();
                              document
                                .getElementById(&#x27;ibm-search-form&#x27;)
                                .setAttribute(&#x27;aria-labelledby&#x27;, &#x27;ibm-masthead&#x27;);
                            }
                          }
                        
                          /**
                        		Creates the popup mashthead.
                        		&lt;br /&gt;This is really NO JS execution and the CSS class hides everything except the logo.
                        
                        		@method createMastheadPopup
                        		@private
                        	**/
                          function createMastheadPopup() {
                            $elements.masthead.addClass(&#x27;ibm-mhtype-popup&#x27;);
                          }
                        
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          //
                          // Menu functions
                          //
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        
                          /**
                        		Creates all the dropdowns.
                        		&lt;br&gt;Array of dropdowns to make was populated from the making of each main link.
                        		&lt;br&gt;Each item in the &quot;makethese&quot; object was created by the main link creation
                        		  function based on the main link data.
                        
                        		@method createDropdownMenus
                        		@private
                        	**/
                          function createDropdownMenus() {
                            $.each(makethese.dropdownmenus, function() {
                              createDropdown(this);
                            });
                          }
                        
                          /**
                        		Creates the dropdown menu for the given main masthead item.
                        
                        		@method createDropdown
                        		@private
                        		@param mastheadLinkData {Object} Data object with the main link ID and set of links to use in it&#x27;s dropdown menu.
                        	**/
                          function createDropdown(mastheadLinkData) {
                            var $trig = $elements.masthead.find(
                                &quot;[data-linkid=&#x27;&quot; + mastheadLinkData.id + &quot;&#x27;]&quot;
                              ),
                              menuLis = &#x27;&#x27;,
                              menuListHtml = &#x27;&#x27;;
                        
                            $.each(mastheadLinkData.data.menuSections, function() {
                              var thisSection = this;
                              menuLis = createLinkList(thisSection.menuItems);
                            });
                        
                            menuListHtml = &#x27;&lt;ul class=&quot;ibm-dropdown-menu&quot;&gt;&#x27; + menuLis + &#x27;&lt;/ul&gt;&#x27;;
                        
                            // Wipe out link since it&#x27;s now a menu trigger and inject the nested UL after the menu link/trigger.
                            $trig.removeAttr(&#x27;href&#x27;);
                        
                            $trig.after(menuListHtml);
                          }
                        
                          /**
                        		Creates all the megamenus.
                        		&lt;br&gt;Array of megamenus to make was populated from the making of each main link.
                        		&lt;br&gt;Each item in the &quot;makethese&quot; object was created by the main link creation
                        		  function based on the main link data.
                        
                        		@method createMegamenus
                        		@private
                        	**/
                          function createMegamenus() {
                            var megamenuSectionsHtml = &#x27;&#x27;,
                              tallestSection = 0,
                              extraCloseButton = 30;
                        
                            $.each(makethese.megamenus, function() {
                              megamenuSectionsHtml += createMegamenuSection(this);
                            });
                        
                            if (document.getElementById(&#x27;ibm-megamenu-sections&#x27;)) {
                              $(document.getElementById(&#x27;ibm-megamenu-sections&#x27;)).remove();
                            }
                        
                            // Echo the MM on the page (including the &quot;close&quot; button), then setup bindings/accessibility.
                            megamenu.$el = $(
                              &#x27;&lt;div id=&quot;ibm-megamenu-sections&quot; class=&quot;ibm-hidden-small&quot;&gt;&#x27; +
                                megamenuSectionsHtml +
                                &#x27;&lt;div class=&quot;ibm-megamenu-close-container&quot;&gt;&lt;p class=&quot;ibm-icononly ibm-ind-link ibm-nospacing&quot;&gt;&lt;a class=&quot;ibm-chevron-up-link ibm-nospacing&quot; href=&quot;#close&quot;&gt;&#x27; +
                                IBM.common.translations.data.v18main.misc.close +
                                &#x27;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&#x27;
                            ).insertAfter(&#x27;#ibm-universal-nav&#x27;);
                            megamenu.$closeButtonLink = megamenu.$el.find(
                              &#x27;.ibm-megamenu-close-container a&#x27;
                            );
                        
                            // Set the height of the MM section to be the tallest of them all.
                            $(document.getElementById(&#x27;ibm-megamenu-sections&#x27;))
                              .addClass(&#x27;getheight&#x27;)
                              .find(&#x27;.ibm-megapanel, .ibm-megapaneltrigs&#x27;)
                              .each(function() {
                                var h = $(this).height();
                                if (h &gt; tallestSection) {
                                  tallestSection = h;
                                }
                              })
                              .end()
                              .removeClass(&#x27;getheight&#x27;);
                        
                            IBM.common.util.addCssRule(
                              &#x27;.ibm-megamenu-section, #ibm-megamenu-sections&#x27;,
                              {
                                height: tallestSection + extraCloseButton + &#x27;px&#x27;,
                              }
                            );
                          }
                        
                          /**
                        		Hides all menus and megamenu. Used on hover to hide anything that was open before opening the new one.
                        
                        		@method hideAllMenus
                        		@private
                        	**/
                          function hideAllMenus() {
                            showMegamenu(false);
                            makeItemActive(
                              mastheadLinklist.mainLinks.$el.find(&#x27;li.ibm-active a&#x27;),
                              false
                            );
                          }
                        
                          /**
                        		Two-level section.
                        		&lt;br&gt;Level 1 (first column) is a list of all &quot;menuItems&quot; which are just link list of triggers for each megapanel.
                        		&lt;br&gt;Level 2 (6-4) is the actual megapanel for each menuitem.
                        
                        		@method createMegamenuSection
                        		@private
                        		@param mastheadLinkData {Object} The main object with all of the masthead data used to create it all.
                        		@return (String) The entire ibm-columns for the main item&#x27;s megamenu.
                        	**/
                          function createMegamenuSection(mastheadLinkData) {
                            var megamenuSectionHtml = &#x27;&#x27;,
                              level1Lis = &#x27;&#x27;,
                              mmSectionMegapanels = &#x27;&#x27;;
                        
                            /**
                        			Creates a basic set of LIs. Used for the &quot;quick links&quot;.
                        
                        			@method createQuicklinksList
                        			@private
                        			@param linksArr {Array} An array of objects with url and title to turn into LIs.
                        			@return {String} The HTML of LIs created.
                        		**/
                            function createQuicklinksList(linksArr) {
                              var lis = &#x27;&#x27;,
                                i = 0;
                        
                              for (i; i &lt; linksArr.length; i++) {
                                lis +=
                                  &#x27;&lt;li&gt;&lt;a class=&quot;ibm-h4 ibm-light&quot; href=&quot;&#x27; +
                                  linksArr[i].url +
                                  &#x27;&quot;&gt;&#x27; +
                                  linksArr[i].title +
                                  &#x27;&lt;/a&gt;&lt;/li&gt;&#x27;;
                              }
                        
                              return lis;
                            }
                        
                            /**
                        			Creates and returns the megapanel&#x27;s 6-2 (on the left, with title and quicklinks).
                        
                        			@method createMegapanelCol1
                        			@private
                        			@param megapanelContent {Object} The megapanel data to use to create the left column (heading and list).
                        			@return {String} The HTML of the megapanel&#x27;s left column contents.
                        		**/
                            function createMegapanelCol1(megapanelContent) {
                              var htmlTempl = &#x27;{descr}{qlTitle}{quickLinks}&#x27;,
                                descr = &#x27;&#x27;,
                                qlTitle = &#x27;&lt;p&gt;&#x27; + megapanelContent.quickLinks.title + &#x27;&lt;/p&gt;&#x27;,
                                quickLinks =
                                  &#x27;&lt;ul class=&quot;ibm-plain-list ibm-mh-quicklinks&quot;&gt;&#x27; +
                                  createQuicklinksList(megapanelContent.quickLinks.links) +
                                  &#x27;&lt;/ul&gt;&#x27;;
                        
                              if (megapanelContent.description &amp;&amp; megapanelContent.description !== &#x27;&#x27;) {
                                descr =
                                  &#x27;&lt;p class=&quot;ibm-h4 ibm-light&quot;&gt;&#x27; +
                                  megapanelContent.description +
                                  &#x27;&lt;/p&gt;&#x27;;
                              }
                        
                              return htmlTempl
                                .replace(&#x27;{descr}&#x27;, descr)
                                .replace(&#x27;{qlTitle}&#x27;, qlTitle)
                                .replace(&#x27;{quickLinks}&#x27;, quickLinks);
                            }
                        
                            /**
                        			Creates and returns the megapanel&#x27;s 6-2 (on the right, with featured item).
                        
                        			@method createMegapanelCol2
                        			@private
                        			@param megapanelContent {Object} The megapanel data to use to create the right column (heading and list).
                        			@return {String} The HTML of the megapanel&#x27;s right column contents.
                        		**/
                            function createMegapanelCol2(megapanelContent) {
                              var img =
                                megapanelContent.feature.imageUrl !== &#x27;&#x27;
                                  ? &#x27;&lt;p&gt;&lt;img data-src=&quot;&#x27; +
                                    megapanelContent.feature.imageUrl.replace(&#x27;http:&#x27;, &#x27;https:&#x27;) +
                                    &#x27;&quot; width=&quot;300&quot; height=&quot;150&quot; alt=&quot;&quot; class=&quot;ibm-resize&quot;&gt;&lt;/p&gt;&#x27;
                                  : &#x27;&#x27;;
                        
                              return (
                                &#x27;&lt;p class=&quot;ibm-bold&quot;&gt;&#x27; +
                                megapanelContent.feature.heading +
                                &#x27;&lt;/p&gt;&#x27; +
                                img +
                                &#x27;&lt;p class=&quot;ibm-linkcolor-default&quot;&gt;&lt;a href=&quot;&#x27; +
                                megapanelContent.feature.linkUrl +
                                &#x27;&quot;&gt;&#x27; +
                                megapanelContent.feature.linkTitle +
                                &#x27;&lt;/a&gt;&lt;/p&gt;&#x27;
                              );
                            }
                        
                            /**
                        			Creates and returns the megapanel&#x27;s heading.
                        
                        			@method makeMenuSectionHeading
                        			@private
                        			@param menuSection {Object} The megapanel data to use to create the heading.
                        			@return {String} The HTML of the megapanel&#x27;s heading.
                        		**/
                            function makeMenuSectionHeading(menuSection) {
                              var html = &#x27;&#x27;;
                              if (menuSection.heading !== &#x27;&#x27;) {
                                html =
                                  &#x27;&lt;li role=&quot;presentation&quot; class=&quot;ibm-mm-sec-heading ibm-bold&quot;&gt;&#x27; +
                                  menuSection.heading +
                                  &#x27;&lt;/li&gt;&#x27;;
                              }
                              return html;
                            }
                        
                            /**
                        			Creates the megapanel trigger list item.
                        
                        			@method createMegapanelTriggerItem
                        			@private
                        			@param level1Item {Object} The data to use to create the megapanel trigger.
                        			@param panelId {String} The ID of the panel that the trigger is for (to show on hover).
                        			@return {String} The HTML for trigger LI created.
                        		**/
                            function createMegapanelTriggerItem(level1Item, panelId) {
                              var linkClass = panelId !== &#x27;&#x27; ? &#x27; ibm-arrow-forward-link&#x27; : &#x27;&#x27;,
                                linkPID = panelId !== &#x27;&#x27; ? &#x27; data-panelid=&quot;&#x27; + panelId + &#x27;&quot;&#x27; : &#x27;&#x27;;
                        
                              return (
                                &#x27;&lt;li role=&quot;presentation&quot;&gt;&lt;a class=&quot;ibm-light ibm-h4&#x27; +
                                linkClass +
                                &#x27;&quot; href=&quot;&#x27; +
                                level1Item.url +
                                &#x27;&quot;&#x27; +
                                linkPID +
                                &#x27;&gt;&#x27; +
                                level1Item.title +
                                &#x27;&lt;/a&gt;&lt;/li&gt;&#x27;
                              );
                            }
                        
                            // For each menu section,
                            // For each item in the section.
                            $.each(mastheadLinkData.data.menuSections, function() {
                              var thisSection = this;
                        
                              // Make the heading for this menu list section.
                              level1Lis += makeMenuSectionHeading(thisSection);
                        
                              // For each menu item (in this section but doesn&#x27;t matter),
                              //   add the item to the list then make the megapanel for it.
                              $.each(thisSection.menuItems, function(i) {
                                var level1Item = this,
                                  hasMegapanel =
                                    level1Item.megapanelContent &amp;&amp;
                                    level1Item.megapanelContent.headingTitle !== &#x27;&#x27;
                                      ? true
                                      : false,
                                  panelId = hasMegapanel ? mastheadLinkData.id + &#x27;-mp&#x27; + i : &#x27;&#x27;;
                        
                                // 1. Add this main item to the list of items on the left that each have a megapanel.
                                level1Lis += createMegapanelTriggerItem(level1Item, panelId);
                        
                                // 2. If this item has a megapanel, build it.
                                if (hasMegapanel) {
                                  mmSectionMegapanels +=
                                    &#x27;&lt;div class=&quot;ibm-megapanel&quot; id=&quot;&#x27; +
                                    panelId +
                                    &#x27;&quot;&gt;&lt;h3 class=&quot;ibm-light ibm-h1 ibm-medium ibm-padding-bottom-1&quot;&gt;&lt;a href=&quot;&#x27; +
                                    level1Item.megapanelContent.headingUrl +
                                    &#x27;&quot;&gt;&#x27; +
                                    level1Item.megapanelContent.headingTitle +
                                    &#x27;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&quot;ibm-columns&quot;&gt;&lt;div class=&quot;ibm-col-6-2&quot;&gt;&#x27; +
                                    createMegapanelCol1(level1Item.megapanelContent) +
                                    &#x27;&lt;/div&gt;&lt;div class=&quot;ibm-col-6-2&quot;&gt;&#x27; +
                                    createMegapanelCol2(level1Item.megapanelContent) +
                                    &#x27;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;;
                                }
                              });
                            });
                        
                            megamenuSectionHtml =
                              &#x27;&lt;div role=&quot;dialog&quot; aria-labelledby=&quot;mhitem-&#x27; +
                              mastheadLinkData.id +
                              &#x27;&quot; class=&quot;ibm-megamenu-section&quot; data-linkid=&quot;&#x27; +
                              mastheadLinkData.id +
                              &#x27;&quot;&gt;&lt;div id=&quot;&#x27; +
                              mastheadLinkData.id +
                              &#x27;&quot; class=&quot;ibm-columns&quot;&gt;&lt;div class=&quot;ibm-col-6-2 ibm-background-neutral-white-30 ibm-megapaneltrigs&quot;&gt;&lt;ul class=&quot;ibm-dropdown-menu ibm-background-neutral-white-30&quot;&gt;&#x27; +
                              level1Lis +
                              &#x27;&lt;/ul&gt;&lt;/div&gt;&lt;div class=&quot;ibm-col-6-4 ibm-background-white-core&quot;&gt;&#x27; +
                              mmSectionMegapanels +
                              &#x27;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;;
                        
                            return megamenuSectionHtml;
                          }
                        
                          /**
                        		Sets up all megamenu bindings (hover, focus, keyboard, etc).
                        		&lt;br&gt;Called deferred because not critical onscreen display on load.
                        		@method setupMegamenuBindings
                        		@private
                        	**/
                          function setupMegamenuBindings() {
                            var mouseOutTimeout = null,
                              mouseoverTimeout = null;
                        
                            // OPENING THE MEGAMENU ONLY:
                            // Onclick of a catnav link:
                            //   If the MM is already open, goto the link.
                            //   If it&#x27;s not open, open that section.
                            // On hover:
                            //   If it&#x27;s not already open, slight pause to make sure they aren&#x27;t doing a mouse flyby.
                            //   If it&#x27;s already open slight pause then show the new section b/c they are already interacting, so make it less delay.
                            mastheadLinklist.mainLinks.$el
                              .hoverIntent(
                                function() {
                                  var menuType = this.getAttribute(&#x27;data-menutype&#x27;),
                                    menuId = this.getAttribute(&#x27;data-linkid&#x27;);
                        
                                  hideAllMenus();
                        
                                  if (menuType === &#x27;dropdown&#x27;) {
                                    makeItemActive($(this), true);
                                  } else if (menuType === &#x27;megamenu&#x27;) {
                                    // If we haven&#x27;t loaded this megamenu&#x27;s images already, load them and set a flag.
                                    if (!mastheadLinklist.imagesloaded[menuId]) {
                                      $(&quot;.ibm-megamenu-section[data-linkid=&#x27;&quot; + menuId + &quot;&#x27;]&quot;)
                                        .find(&#x27;img[data-src]&#x27;)
                                        .each(function() {
                                          $(this).attr(&#x27;src&#x27;, $(this).data(&#x27;src&#x27;));
                                        });
                                      mastheadLinklist.imagesloaded[menuId] = true;
                                    }
                        
                                    showMegamenuSection(menuId);
                                    showMegamenu(true);
                                    makeItemActive($(this), true);
                                  }
                        
                                  fireHoverMetricEvent({
                                    id: menuId,
                                    title: this.innerHTML,
                                    type: menuType,
                                  });
                                },
                                function() {
                                  // do nothing on mouse out. Covered by larger scoped element mouseout binding.
                                },
                                &#x27;&gt;li&gt;a&#x27;
                              )
                              .on(&#x27;click keydown&#x27;, &#x27;&gt;li&gt;a&#x27;, function(evt) {
                                var menuType = this.getAttribute(&#x27;data-menutype&#x27;),
                                  menuId = this.getAttribute(&#x27;data-linkid&#x27;);
                        
                                // Only open the menu on keydown event if they hit enter, else keyboard navigation controls ensue.
                                if (evt.type === &#x27;keydown&#x27; &amp;&amp; evt.keyCode !== 13) {
                                  return;
                                }
                        
                                hideAllMenus();
                        
                                if (menuType === &#x27;dropdown&#x27;) {
                                  evt.preventDefault();
                                  makeItemActive($(this), true);
                                  $(this)
                                    .next(&#x27;ul&#x27;)
                                    .find(&#x27;a:first&#x27;)
                                    .focus();
                                } else if (menuType === &#x27;megamenu&#x27;) {
                                  evt.preventDefault();
                                  showMegamenuSection(menuId);
                                  showMegamenu(true);
                                  megamenu.$sectionShowing.find(&#x27;a:first&#x27;).focus();
                                }
                              });
                            // .on(&quot;focus&quot;, &quot;&gt;li&gt;a&quot;, function () {
                            // 	var menuType = this.getAttribute(&quot;data-menutype&quot;);
                            // 	// // Dropdown menus only, open and focus on first item.
                            // 	// if (menuType === &quot;dropdown&quot;) {
                            // 	// 	makeItemActive($(this), true);
                            // 	// 	$(this).next(&quot;ul&quot;).find(&quot;a:first&quot;).focus();
                            // 	// }
                            // });
                        
                            // CLOSING THE MEGAMENU ONLY:
                            // Setup mouseout to close the menu after a small waiting period, to make sure they just move the mouse out and back in.
                            // If they mouse back in within the timeframe, cancel the megamenu closing.
                            // Hover is jq multi-event (mousein, mouseout)
                            mastheadLinklist.mainLinks.$el
                              .children(&#x27;li&#x27;)
                              .add(megamenu.$el)
                              .hover(
                                function() {
                                  clearTimeout(mouseOutTimeout);
                                },
                                function() {
                                  clearTimeout(mouseoverTimeout);
                        
                                  mouseOutTimeout = setTimeout(function() {
                                    hideAllMenus();
                                  }, 400);
                                }
                              );
                        
                            // The close icon at the bottom.
                            megamenu.$closeButtonLink.click(function(evt) {
                              evt.preventDefault();
                        
                              showMegamenu(false);
                        
                              mastheadLinklist.mainLinks.$el.find(&quot;a[tabindex=&#x27;0&#x27;]&quot;).focus();
                            });
                        
                            // KEYBOARD TABBING RULES.
                            // If they hit escape, close the MM.
                            // If they tab from either end link, loop back around.
                            // Use .on for delegation so we only bind 1 main parent DOM element instead of wasting binding every link. Hello speed.
                            megamenu.$el.on(&#x27;keydown&#x27;, function(evt) {
                              // If they try and tab FORWARD and they were on the last link in the visible MM section, goto close link.
                              // If they tab forward from close link, goto first link.
                              // Do all opposites.
                              // If they hit ESCAPE, close MM and return to orig Cat.nav link they clicked.
                        
                              // If they try and tab FORWARD and they were on the last link in the visible MM section, goto close link.
                              // If they tab forward from close link, goto first link.
                        
                              var $gotoLink = &#x27;&#x27;;
                        
                              if (evt.keyCode === 9 &amp;&amp; !evt.shiftKey) {
                                if ($(evt.target).is(megamenu.$sectionShowing.find(&#x27;a:last&#x27;))) {
                                  $gotoLink = megamenu.$closeButtonLink;
                                } else if ($(evt.target).is(megamenu.$closeButtonLink)) {
                                  $gotoLink = megamenu.$sectionShowing.find(&#x27;a:first&#x27;);
                                }
                              } else if (evt.keyCode === 9 &amp;&amp; evt.shiftKey) {
                                if ($(evt.target).is(megamenu.$sectionShowing.find(&#x27;a:first&#x27;))) {
                                  $gotoLink = megamenu.$closeButtonLink;
                                } else if ($(evt.target).is(megamenu.$closeButtonLink)) {
                                  $gotoLink = megamenu.$panelShowing.find(&#x27;a:last&#x27;);
                                }
                              } else if (evt.keyCode === 27) {
                                showMegamenu(false);
                                mastheadLinklist.mainLinks.$el.find(&quot;a[tabindex=&#x27;0&#x27;]&quot;).focus();
                              }
                        
                              // If we set a link to goto, stop the default tab action and goto our custom link EL.
                              if ($gotoLink !== &#x27;&#x27;) {
                                evt.preventDefault();
                                $gotoLink.focus();
                              }
                            });
                        
                            ////////////////////////////////////////////////////////////////////////////////////////
                            // NEW: Megapanel bindings
                            ////////////////////////////////////////////////////////////////////////////////////////
                        
                            // Need to sort out keyboard controls and tab ring with Jolic and Lahart to find optimal experience
                            $(document.getElementsByClassName(&#x27;ibm-megapaneltrigs&#x27;))
                              .hoverIntent(
                                function() {
                                  showMegamenuPanel(this.getAttribute(&#x27;data-panelid&#x27;));
                        
                                  makeItemActive(
                                    $(document.getElementsByClassName(&#x27;ibm-megapaneltrigs&#x27;)).find(&#x27;a&#x27;),
                                    false
                                  );
                        
                                  makeItemActive($(this), true);
                        
                                  $(document.getElementsByClassName(&#x27;ibm-megapaneltrigs&#x27;))
                                    .find(&#x27;a&#x27;)
                                    .blur();
                        
                                  fireHoverMetricEvent({
                                    id: this.getAttribute(&#x27;data-panelid&#x27;),
                                    url: this.getAttribute(&#x27;href&#x27;),
                                    title: this.innerHTML,
                                    type: &#x27;megapanel trigger&#x27;,
                                  });
                                },
                                function() {
                                  // do nothing.
                                },
                                &#x27;a&#x27;
                              )
                              .on(&#x27;click&#x27;, &#x27;a&#x27;, function(evt) {
                                // If it&#x27;s a link and not a menu trigger (doesn&#x27;t have a panel associated with it),
                                // goto that page link.
                                if (!this.getAttribute(&#x27;data-panelid&#x27;)) {
                                  return;
                                }
                        
                                evt.preventDefault();
                        
                                // Open the panel
                                showMegamenuPanel(this.getAttribute(&#x27;data-panelid&#x27;));
                                makeItemActive(
                                  $(document.getElementsByClassName(&#x27;ibm-megapaneltrigs&#x27;)).find(&#x27;a&#x27;),
                                  false
                                );
                                makeItemActive($(this), true);
                        
                                // Focus on first link in the panel
                                //megamenu.$panelShowing.find(&quot;:focusable:first&quot;).focus();
                              });
                          }
                        
                          /**
                        		Adds or removes the active class to the passed megapanel trigger item.
                        
                        		@method makeItemActive
                        		@param $triggerLink (jQuery selector) The trigger to show as active.
                        		@param showit (Boolean) To set the trigger as active or not.
                        	**/
                          function makeItemActive($triggerLink, showit) {
                            if (showit) {
                              $triggerLink.parent().addClass(&#x27;ibm-active&#x27;);
                            } else {
                              $triggerLink.parent().removeClass(&#x27;ibm-active&#x27;);
                            }
                          }
                        
                          /**
                        		Public API to show the megamenu.
                        		&lt;br&gt;Need to also call public API to tell it which megamenu to show.
                        		&lt;br&gt;Used on hover of a main masthead item.
                        
                        		@method showMegamenu
                        		@param bool {Boolean} Show the megamenu or not (a section needs to be set to active).
                        	**/
                          me.showMegamenu = showMegamenu;
                          function showMegamenu(bool) {
                            if (bool) {
                              $elements.body.addClass(&#x27;ibm-masthead-megamenu-showing&#x27;);
                              megamenu.isopen = true;
                            } else {
                              // Remove the class that shows the stuff,
                              // then set flags.
                              $elements.body.removeClass(&#x27;ibm-masthead-megamenu-showing&#x27;);
                        
                              // This gets set to true when called to show the megamenu, and will negate the &#x27;remove class&#x27; timeout below.
                              // This means when we move from section to section the megapanel won&#x27;t close and it&#x27;ll stay open.
                              // But if the panel hasn&#x27;t been opened after 3 seconds, remove show class so tabbing doesn&#x27;t tab to it.
                              megamenu.isopen = false;
                        
                              // Cleanup
                              // Delay this so that we don&#x27;t slide up an empty container.
                              // Remove the &quot;showing&quot; class from the megamenu container if we aren&#x27;t actually showing the megamenu.
                              setTimeout(function() {
                                if (!megamenu.isopen &amp;&amp; megamenu.$sectionShowing) {
                                  megamenu.$sectionShowing.removeClass(&#x27;ibm-showing&#x27;);
                                  megamenu.$sectionShowing = null;
                        
                                  if (megamenu.$panelShowing) {
                                    megamenu.$panelShowing.removeClass(&#x27;ibm-showing&#x27;);
                                    megamenu.$panelShowing = null;
                                  }
                                }
                              }, 3000);
                            }
                          }
                        
                          /**
                        		Public API to show a particular megapanel within a particular megamenu.
                        		&lt;br&gt;Used on hover of a megamenu panel trigger.
                        
                        		@method showMegamenuPanel
                        		@param panelId {String} The ID of the particular panel to show in the megamenu section.
                        	**/
                          me.showMegamenuPanel = showMegamenuPanel;
                          function showMegamenuPanel(panelId) {
                            if (!panelId) {
                              return;
                            }
                        
                            if (megamenu.$panelShowing) {
                              megamenu.$panelShowing.removeClass(&#x27;ibm-showing&#x27;);
                            }
                        
                            megamenu.$panelShowing = $(document.getElementById(panelId)).addClass(
                              &#x27;ibm-showing&#x27;
                            );
                          }
                        
                          /**
                        		Public API to set which megamenu/section to show (for which main masthead link).
                        		&lt;br&gt;Used on hover of main masthead item.
                        
                        		@method showMegamenuSection
                        		@param sectionId {String}
                        	**/
                          me.showMegamenuSection = showMegamenuSection;
                          function showMegamenuSection(sectionId) {
                            // Reset which section and panel are showing.
                            // Then show the proper megamenu and show the first panel by default.
                            if (megamenu.$sectionShowing) {
                              megamenu.$sectionShowing.removeClass(&#x27;ibm-showing&#x27;);
                            }
                            if (megamenu.$panelShowing) {
                              megamenu.$panelShowing.removeClass(&#x27;ibm-showing&#x27;);
                            }
                        
                            megamenu.$sectionShowing = $(
                              &quot;.ibm-megamenu-section[data-linkid=&#x27;&quot; + sectionId + &quot;&#x27;]&quot;
                            ).addClass(&#x27;ibm-showing&#x27;);
                        
                            // Show the first panel by default and clear and highlight the corresponding item in the trigger menu.
                            showMegamenuPanel(
                              megamenu.$sectionShowing.find(&#x27;.ibm-megapanel:first&#x27;)[0].id
                            );
                            megamenu.$sectionShowing
                              .find(&#x27;.ibm-megapaneltrigs li.ibm-active&#x27;)
                              .removeClass(&#x27;ibm-active&#x27;);
                            megamenu.$sectionShowing
                              .find(&quot;.ibm-megapaneltrigs a[data-panelid=&#x27;&quot; + sectionId + &quot;-mp0&#x27;]&quot;)
                              .parent()
                              .addClass(&#x27;ibm-active&#x27;);
                          }
                        
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          //
                          // Misc functions
                          //
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                          ////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        
                          /**
                        		Makes and returns basic LIs.
                        
                        		@method createLinkList
                        		@private
                        		@param linksArr {Array} List of objects to turn into link list items (LI)s.
                        		@return {String} The HTML of LIs created.
                        	**/
                          function createLinkList(linksArr) {
                            var lis = &#x27;&#x27;,
                              i = 0;
                        
                            for (i; i &lt; linksArr.length; i++) {
                              lis +=
                                &#x27;&lt;li&gt;&lt;a href=&quot;&#x27; +
                                linksArr[i].url +
                                &#x27;&quot;&gt;&#x27; +
                                linksArr[i].title +
                                &#x27;&lt;/a&gt;&lt;/li&gt;&#x27;;
                            }
                        
                            return lis;
                          }
                        
                          /**
                        		Creates each of the individual icon links to use in the masthead.
                        		&lt;br /&gt;Each icon can be disabled with a standard &quot;config.set&quot; utility option.
                        
                        		@method createLinklistIconsonly
                        		@private
                        		@return {String} The link list UL HTML to inject in the masthead if links exist.
                        	**/
                          function createLinklistIconsonly() {
                            var html = &#x27;&#x27;;
                        
                            // The profile icon item/button/trigger.
                            if (
                              (IBM.common.util.config.isEnabled(&#x27;masthead.profile&#x27;) &amp;&amp;
                                v18Data.profileMenu.signedout.length &gt; 0) ||
                              IBM.common.util.config.isEnabled(&#x27;masthead.profileAlways&#x27;)
                            ) {
                              html +=
                                &#x27;&lt;li role=&quot;presentation&quot; class=&quot;ibm-masthead-item-signin&quot;&gt;&lt;button role=&quot;button&quot; aria-haspopup=&quot;true&quot; aria-owns=&quot;ibm-signin-minimenu-container&quot; class=&quot;ibm-profile-link&quot;&gt;&#x27; +
                                (v18Data.profileMenu.signedout[0]
                                  ? v18Data.profileMenu.signedout[0].title
                                  : &#x27;&#x27;) +
                                &#x27;&lt;/button&gt;&lt;/li&gt;&#x27;;
                            }
                        
                            // The hamburger menu icon, unless it was disabled for some dumb reason.
                            if (IBM.common.util.config.isEnabled(&#x27;masthead.mobilemenu&#x27;)) {
                              html +=
                                &#x27;&lt;li role=&quot;presentation&quot; class=&quot;ibm-masthead-item-menu&quot;&gt;&lt;button role=&quot;button&quot; aria-haspopup=&quot;true&quot; aria-owns=&quot;ibm-burger-menu-container&quot; class=&quot;ibm-menu-link&quot;&gt;&#x27; +
                                v18Data.misc.sitenav +
                                &#x27;&lt;/button&gt;&lt;/li&gt;&#x27;;
                            }
                        
                            if (html !== &#x27;&#x27;) {
                              html =
                                &#x27;&lt;ul aria-label=&quot;Tools&quot; role=&quot;menubar&quot; class=&quot;ibm-masthead-iconsonly&quot;&gt;&#x27; +
                                html +
                                &#x27;&lt;/ul&gt;&#x27;;
                            }
                        
                            return html;
                          }
                        
                          /**
                        		Loops thru translation file link array and creates the masthead main category link list.
                        
                        		@method createMainMastheadLinks
                        		@private
                        		@return {String} The link list UL HTML to inject in the masthead if links exist.
                        	**/
                          function createMainMastheadLinks() {
                            var html = &#x27;&#x27;;
                        
                            //   Class determines if the icon/chevron shows up or not.
                            //   Data-attr provides owning section or menu.
                            //   Second data-attr provides type of menu: dropdown or megamenu.
                            if (mastheadData.mainLinks.links.length &gt; 0) {
                              $.each(mastheadData.mainLinks.links, function(i) {
                                var addClass = this.hasMenu ? &#x27; ibm-hasmenu&#x27; : &#x27;&#x27;,
                                  linkClass =
                                    addClass !== &#x27;&#x27;
                                      ? &#x27; class=&quot;ibm-chevron-down-link ibm-icon-after&quot;&#x27;
                                      : &#x27;&#x27;,
                                  menuType = this.hasMegapanel
                                    ? &#x27;megamenu&#x27;
                                    : this.hasMenu
                                    ? &#x27;dropdown&#x27;
                                    : &#x27;none&#x27;;
                        
                                html +=
                                  &#x27;&lt;li role=&quot;presentation&quot; class=&quot;ibm-mh-mainitem&#x27; +
                                  addClass +
                                  &#x27;&quot;&gt;&lt;a role=&quot;button&quot; href=&quot;&#x27; +
                                  this.url +
                                  &#x27;&quot; id=&quot;mhitem-mms&#x27; +
                                  i +
                                  &#x27;&quot; data-linkid=&quot;mms&#x27; +
                                  i +
                                  &#x27;&quot;&#x27; +
                                  linkClass +
                                  &#x27; data-menutype=&quot;&#x27; +
                                  menuType +
                                  &#x27;&quot;&gt;&#x27; +
                                  this.title.htmlspecialchars() +
                                  &#x27;&lt;/a&gt;&lt;/li&gt;&#x27;;
                        
                                // If the main link has a menu (either type) add it to the array of menus we need to build.
                                if (menuType === &#x27;megamenu&#x27;) {
                                  makethese.megamenus.push({
                                    id: &#x27;mms&#x27; + i,
                                    data: this,
                                  });
                                } else if (menuType === &#x27;dropdown&#x27;) {
                                  makethese.dropdownmenus.push({
                                    id: &#x27;mms&#x27; + i,
                                    data: this,
                                  });
                                }
                              });
                        
                              html =
                                &#x27;&lt;ul aria-label=&quot;&#x27; +
                                v18Data.unav.title +
                                &#x27;&quot; role=&quot;toolbar&quot; class=&quot;ibm-masthead-categories&quot;&gt;&#x27; +
                                html +
                                &#x27;&lt;/ul&gt;&#x27;;
                            }
                        
                            return html;
                          }
                        
                          /**
                        		Creates a the list of links for the burger menu. The provider of the links.
                        		&lt;br&gt;The burger menu uses this returned/stored HTML to populate the burger menu.
                        
                        		@method createMainMastheadLinksBurgermenu
                        		@private
                        		@param linkSet {Array} An array of data to turn into a list of links. Sets as show/hide if applicable.
                        		@return {String} The HTML of the full UL created from the passed link set.
                        	**/
                          function createMainMastheadLinksBurgermenu(linkSet) {
                            var html = &#x27;&#x27;;
                        
                            // Generic function to make a basic list item from a common link object/data.
                            function makeLis(menuItems) {
                              var i = 0,
                                lis = &#x27;&#x27;,
                                url = &#x27;&#x27;;
                        
                              for (i; i &lt; menuItems.length; i++) {
                                // TEMP backup. TODO: Santelia: remove when URLs are live.
                                // Safety in case menu item URL is empty, use the megapanel heading one instead.
                                // This switch will be removed once URLs are added to ECM translation. and always use .url.
                                url =
                                  menuItems[i].url !== &#x27;&#x27;
                                    ? menuItems[i].url
                                    : menuItems[i].megapanelContent.headingUrl;
                                lis += &#x27;&lt;li&gt;&lt;a href=&quot;&#x27; + url + &#x27;&quot;&gt;&#x27; + menuItems[i].title + &#x27;&lt;/a&gt;&lt;/li&gt;&#x27;;
                              }
                        
                              return lis;
                            }
                        
                            function convertToShowhide(mainItem, subMenuLis) {
                              var html =
                                &#x27;&lt;div data-widget=&quot;showhide&quot; data-type=&quot;panel&quot; class=&quot;ibm-show-hide&quot;&gt;&lt;h2&gt;&#x27; +
                                mainItem.title.htmlspecialchars() +
                                &#x27;&lt;/h2&gt;&lt;div class=&quot;ibm-container-body&quot;&gt;&lt;ul&gt;&#x27; +
                                subMenuLis +
                                &#x27;&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&#x27;;
                        
                              return html;
                            }
                        
                            // If there are item in the array passed, make a link for each one.
                            if (linkSet.length &gt; 0) {
                              $.each(linkSet, function() {
                                var linkItem = &#x27;&#x27;,
                                  subMenuLis = &#x27;&#x27;,
                                  i = 0;
                        
                                // MENU ITEM/LIST ITEM LINKS generation
                                // Build the drop-down/menu items.
                                if (this.menuSections &amp;&amp; this.menuSections.length &gt; 0) {
                                  for (i; i &lt; this.menuSections.length; i++) {
                                    subMenuLis += makeLis(this.menuSections[i].menuItems);
                                  }
                                } else if (this.menuItems &amp;&amp; this.menuItems.length &gt; 0) {
                                  subMenuLis += makeLis(this.menuItems);
                                }
                        
                                // SHOW/HIDE SETUP.
                                // If it had subMenuLis, this main masthead link needs to be created as a show/hide instead of a normal list link item.
                                // Else create this MAIN masthead item as a plain main link
                                if (subMenuLis !== &#x27;&#x27;) {
                                  linkItem = convertToShowhide(this, subMenuLis);
                                } else {
                                  linkItem =
                                    &#x27;&lt;a href=&quot;&#x27; +
                                    this.url +
                                    &#x27;&quot;&gt;&#x27; +
                                    this.title.htmlspecialchars() +
                                    &#x27;&lt;/a&gt;&#x27;;
                                }
                        
                                // Add the link inside a list list and append it to returned HTML.
                                // This is either a plain &lt;a&gt; or will be a &lt;a&gt; that is a trigger for a show/hide with
                                //  nested UL list of links in it.
                                html += &#x27;&lt;li&gt;&#x27; + linkItem + &#x27;&lt;/li&gt;&#x27;;
                              });
                              // End for each main masthead link.
                        
                              // Put the entire list of masthead links and submenus in a list and return for storing.
                              html =
                                &#x27;&lt;ul class=&quot;ibm-mobilemenu-mhlinks&quot; aria-label=&quot;&#x27; +
                                v18Data.unav.title +
                                &#x27;&quot;&gt;&#x27; +
                                html +
                                &#x27;&lt;/ul&gt;&#x27;;
                            }
                        
                            return html;
                          }
                        
                          /**
                        		Common function used to fire a metrics event for various masthead UI interactions.
                        
                        		@method fireHoverMetricEvent
                        		@param data {Object} The data to use for the metrics event.
                        		@param data.id {String} The ID to use for the metrics event.
                        		@param data.title {String} The title to use for the metrics event.
                        		@param data.type {String} The type to use for the metrics event.
                        	**/
                          function fireHoverMetricEvent(data) {
                            IBM.common.util.statshelper.fireEvent({
                              ibmEV: &#x27;masthead&#x27;,
                              ibmEvAction: &#x27;hover&#x27;,
                              ibmEvGroup: data.id,
                              ibmEvLinkTitle: data.title,
                              ibmEvSection: data.type,
                            });
                          }
                        
                          /**
                        		Returns object with all of the built masthead link list HTML objects.
                        
                        		@method getMastheadLinklists
                        		@return {Object} The object containing all of the masthead link lists HTML. Used by mobile menu widget.
                        	**/
                          me.getMastheadLinklists = function() {
                            return mastheadLinklist;
                          };
                        
                          /**
                        		Public API that calculates the point at which the masthead main links get hidden and injects CSS block.
                        		&lt;br&gt;Gets widths of logo and main nav elements and dynamically injects a media query style for when to
                        		 hide the main links because the won&#x27;t fit across the screen.
                        
                        		@method setMastheadWidthUsed
                        	**/
                          me.setMastheadWidthUsed = setMastheadWidthUsed;
                          function setMastheadWidthUsed() {
                            var w = 0;
                        
                            // Get the width of the three elements that they take up, including margins.
                            // Items that are set as absolute position have to be specifically named to get the proper visual width.
                            $(document.getElementById(&#x27;ibm-universal-nav&#x27;))
                              .addClass(&#x27;getWidth&#x27;)
                              .find(
                                &#x27;#ibm-home, .ibm-masthead-categories, .ibm-masthead-rightside, .ibm-parent-site-name&#x27;
                              )
                              .each(function() {
                                w += $(this).outerWidth(true);
                              })
                              .end()
                              .removeClass(&#x27;getWidth&#x27;);
                        
                            if (!document.getElementById(&#x27;ibm-masthead-hidelinks&#x27;)) {
                              $(&#x27;head&#x27;).append(&#x27;&lt;style id=&quot;ibm-masthead-hidelinks&quot;&gt;&lt;/style&gt;&#x27;);
                            }
                        
                            // Inject the dynamic media query style to hide masthead links and megamenu under XX screen width.
                            document.getElementById(&#x27;ibm-masthead-hidelinks&#x27;).innerHTML =
                              &#x27;@media screen and (max-width: &#x27; +
                              (w + 50) +
                              &#x27;px) { .ibm-masthead-categories,#ibm-megamenu-sections{display:none} }&#x27;;
                          }
                        
                          /**
                        		Sets up focus, tabstops, &amp;amp; arrow controls for the main masthead links.
                        		&lt;br /&gt;Called after megamenu has been created and injected and bindings set. AKA: last.
                        
                        		@method setupMastheadMainlinksAccessibility
                        		@private
                        	**/
                          function setupMastheadProfileMenuAccessibility() {
                            // CUSTOM controls for icononly list items (right side masthead) because it&#x27;s a special menu setup - buttons instead of items.
                            // Cross between toolbar and menubar. We don&#x27;t want the menu to open by default, because it&#x27;s
                            //  a wonky experience when there&#x27;s only one menu and the other thing is like an overlay/button, per convo Marc Johlic.
                            // This sets up the tab out (close the menu) and the arrow controls of the profile drop-down menu.
                            var $mastheadIcons = $elements.masthead.find(&#x27;.ibm-masthead-iconsonly&#x27;);
                        
                            if ($mastheadIcons.children(&#x27;li&#x27;).length &gt; 0) {
                              IBM.common.util.a11y.makeToolbarAccessible({
                                el: $mastheadIcons[0],
                                keydown: function(el, evt) {
                                  // Set what link to focus on.
                                  var focusLink = null;
                        
                                  switch (evt.originalEvent.keyCode) {
                                    case 9: // Tab just closes the menu (if it was open)
                                      me.hideProfileMenu();
                                      break;
                        
                                    case 27: // Esc - focus first on the main item that has the menu open, then close the menu.
                                      focusLink = $mastheadIcons.find(&#x27;li.ibm-active button&#x27;).focus();
                                      me.hideProfileMenu();
                                      break;
                        
                                    case 38: // Up arrow
                                      focusLink =
                                        $(el)
                                          .parent()
                                          .prev()
                                          .children(&#x27;a&#x27;)[0] ||
                                        $(el)
                                          .closest(&#x27;ul&#x27;)
                                          .find(&#x27;a:eq(-1)&#x27;);
                                      break;
                        
                                    case 40: // Down arrow
                                      focusLink =
                                        $(el)
                                          .parent()
                                          .next()
                                          .children(&#x27;a&#x27;)[0] ||
                                        $(el)
                                          .closest(&#x27;ul&#x27;)
                                          .find(&#x27;a:eq(0)&#x27;);
                                      break;
                                  }
                        
                                  // If we set a link to focus on, do it.
                                  if (focusLink !== null) {
                                    $(focusLink).focus();
                                  }
                                },
                              });
                            }
                          }
                        
                          /**
                        		Sets up focus, tabstops, &amp;amp; arrow controls for the main masthead links.
                        		&lt;br /&gt;Called after megamenu has been created and injected and bindings set. AKA: last.
                        
                        		@method setupMastheadMainlinksAccessibility
                        		@private
                        	**/
                          function setupMastheadMainlinksAccessibility() {
                            // Special keyboard control for main masthead items and menus.
                            IBM.common.util.a11y.makeToolbarAccessible({
                              el: $elements.masthead.find(&#x27;.ibm-masthead-categories&#x27;)[0],
                              keydown: function(el, evt) {
                                if (el.getAttribute(&#x27;data-menutype&#x27;) === null) {
                                  var focusLink = null;
                        
                                  switch (evt.originalEvent.keyCode) {
                                    case 9: // Tab
                                      hideAllMenus();
                                      // Reset tab placeholder to main item.
                                      $(el)
                                        .closest(&#x27;.ibm-mh-mainitem&#x27;)
                                        .children(&#x27;a&#x27;)
                                        .attr(&#x27;tabindex&#x27;, &#x27;0&#x27;);
                        
                                      // If they backtabbed, we have to focus on previous element so it tabs off menu bar,
                                      //  then set tabindex back to this main item for tab forward placeholder again.
                                      if (evt.originalEvent.shiftKey) {
                                        $(el)
                                          .closest(&#x27;.ibm-mh-mainitem&#x27;)
                                          .prev()
                                          .children(&#x27;a&#x27;)
                                          .focus()
                                          .attr(&#x27;tabindex&#x27;, &#x27;-1&#x27;);
                                        $(el)
                                          .closest(&#x27;.ibm-mh-mainitem&#x27;)
                                          .children(&#x27;a&#x27;)
                                          .attr(&#x27;tabindex&#x27;, &#x27;0&#x27;);
                                      }
                        
                                      break;
                        
                                    case 37: // Left arrow
                                      $(el)
                                        .closest(&#x27;.ibm-mh-mainitem&#x27;)
                                        .prev()
                                        .children(&#x27;a&#x27;)
                                        .focus();
                                      hideAllMenus();
                        
                                      break;
                        
                                    case 38: // Up arrow
                                      focusLink =
                                        $(el)
                                          .parent()
                                          .prev()
                                          .children(&#x27;a&#x27;)[0] ||
                                        $(el)
                                          .closest(&#x27;ul&#x27;)
                                          .find(&#x27;a:eq(-1)&#x27;);
                        
                                      break;
                        
                                    case 39: // Right arrow
                                      $(el)
                                        .closest(&#x27;.ibm-mh-mainitem&#x27;)
                                        .next()
                                        .children(&#x27;a&#x27;)
                                        .focus();
                                      hideAllMenus();
                        
                                      break;
                        
                                    case 40: // Down arrow
                                      focusLink =
                                        $(el)
                                          .parent()
                                          .next()
                                          .children(&#x27;a&#x27;)[0] ||
                                        $(el)
                                          .closest(&#x27;ul&#x27;)
                                          .find(&#x27;a:eq(0)&#x27;);
                        
                                      break;
                                  }
                        
                                  if (focusLink !== null) {
                                    $(focusLink).focus();
                                  }
                                }
                              },
                            });
                          }
                        
                          /**
                        		Sets up the burger menu icon binding to open it on click.
                        
                        		@method setupBurgerMenuIcon
                        		@private
                        	**/
                          function setupBurgerMenuIcon() {
                            if (IBM.common.util.config.isEnabled(&#x27;masthead.mobilemenu&#x27;)) {
                              $(document.getElementsByClassName(&#x27;ibm-masthead-iconsonly&#x27;))
                                .find(&#x27;.ibm-masthead-item-menu button&#x27;)
                                .click(function(evt) {
                                  evt.preventDefault();
                        
                                  IBM.common.module.mobilemenu.toggle();
                                });
                            }
                          }
                        
                          /**
                        		Sets up how to show the search field; normal or minimized or maximized on resize.
                        
                        		@method setupSearchfieldResponsiveness
                        		@private
                        	**/
                          function setupSearchfieldResponsiveness() {
                            var didResize = false;
                        
                            // Run toggle functions on load and then check/run on resize.
                            toggleSearchField();
                        
                            $(window).on(&#x27;resize&#x27;, function() {
                              didResize = true;
                            });
                        
                            setInterval(function() {
                              if (didResize) {
                                didResize = false;
                                toggleSearchField();
                              }
                            }, 100);
                          }
                        
                          /**
                        		Calls the public API to show the search field a certain way based on browser width.
                        
                        		@method toggleSearchField
                        	**/
                          function toggleSearchField() {
                            if (IBM.common.module.mastheadsearch.getDisplayState() === &#x27;maximized&#x27;) {
                              return;
                            }
                        
                            if ($(window).width() &lt; 580) {
                              IBM.common.module.mastheadsearch.showAs(&#x27;minimized&#x27;);
                            } else {
                              IBM.common.module.mastheadsearch.showAs(&#x27;default&#x27;);
                            }
                          }
                        
                          /* Wait for events to happen.
                           **********************************************************************************************/
                        
                          // When translations are ready, call autoInit to build it. Translations can be cached, so use runAsap also.
                          IBM.common.translations
                            .subscribe(&#x27;dataReady&#x27;, &#x27;Masthead&#x27;, me.autoInit)
                            .runAsap(me.autoInit);
                        
                          // Dynamically add a CSS block to shift the right icons over # of PX that scrollbars took up when we hide them.
                          me.subscribe(&#x27;ready&#x27;, &#x27;dyncss&#x27;, function() {
                            IBM.common.util.addCssRule(
                              &#x27;#ibm-com.ibm-no-scroll #ibm-universal-nav .ibm-masthead-iconsonly&#x27;,
                              {
                                &#x27;margin-right&#x27;:
                                  parseInt(
                                    $(document.getElementById(&#x27;ibm-universal-nav&#x27;))
                                      .find(&#x27;.ibm-masthead-iconsonly&#x27;)
                                      .css(&#x27;margin-right&#x27;),
                                    10
                                  ) +
                                  IBM.common.util.getScrollbarWidth() +
                                  &#x27;px&#x27;,
                              }
                            );
                          });
                        })(jQuery, IBMCore);
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
